<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π WebApp</title>
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js?17"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            margin: 0;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            min-height: 120px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            text-align: center;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üì° Telegram WebApp</h2>
        
        <div id="initDataInfo" class="info" style="display: none;"></div>
        
        <label>–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:</label>
        <textarea id="dataToSend" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏"></textarea>
        
        <button id="sendDataBtn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram</button>
        <button id="copyDataBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
        <button id="expandBtn">‚ÜïÔ∏è –†–∞—Å—à–∏—Ä–∏—Ç—å WebApp</button>
        <button id="closeAppBtn">‚ùå –ó–∞–∫—Ä—ã—Ç—å WebApp</button>
        
        <div id="status"></div>
    </div>

    <script>
        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram
        (function() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp API
                if (typeof window.Telegram === 'undefined' || typeof Telegram.WebApp === 'undefined') {
                    document.getElementById('status').innerHTML = 
                        '<div class="error">‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏ Telegram!</div>';
                    alert('‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏ Telegram!');
                    return;
                }

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
                const webApp = Telegram.WebApp;
                webApp.ready();
                webApp.expand(); // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const initDataInfo = document.getElementById('initDataInfo');
                if (webApp.initData) {
                    try {
                        const user = webApp.initDataUnsafe.user;
                        if (user) {
                            initDataInfo.innerHTML = `
                                <strong>WebApp –æ—Ç–∫—Ä—ã—Ç –≤ Telegram</strong><br>
                                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name || ''} ${user.last_name || ''}<br>
                                ID: ${user.id || 'N/A'}
                            `;
                            initDataInfo.style.display = 'block';
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ initData:', e);
                    }
                }

                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                document.getElementById('dataToSend').value = 
                    `–î–∞–Ω–Ω—ã–µ –∏–∑ WebApp\n–í—Ä–µ–º—è: ${new Date().toLocaleString()}\n–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${navigator.platform}`;

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                function showStatus(message, type = 'info') {
                    const statusDiv = document.getElementById('status');
                    statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
                }

                // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ sendData() - —Å—Ç—Ä–æ–≥–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
                document.getElementById('sendDataBtn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    try {
                        const data = document.getElementById('dataToSend').value.trim();
                        if (!data) {
                            showStatus('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏!', 'error');
                            return;
                        }

                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã (4096 —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
                        if (data.length > 4096) {
                            showStatus('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ (–º–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤)!', 'error');
                            return;
                        }

                        console.log('üì§ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', data.length, '—Å–∏–º–≤–æ–ª–æ–≤');
                        
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–≥–∏–π –ø–æ–¥—Ö–æ–¥ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
                        webApp.sendData(data);
                        
                        console.log('‚úÖ sendData() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                        showStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤–æ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–º –æ–∫–Ω–µ Telegram.', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ sendData:', error);
                        showStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message, 'error');
                        alert('–û—à–∏–±–∫–∞: ' + error.message);
                    }
                });

                // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                document.getElementById('copyDataBtn').addEventListener('click', function(e) {
                    e.preventDefault();
                    const data = document.getElementById('dataToSend').value.trim();
                    if (!data) {
                        showStatus('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!', 'error');
                        return;
                    }
                    
                    navigator.clipboard.writeText(data).then(function() {
                        showStatus('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã! –í—Å—Ç–∞–≤—å—Ç–µ –∏—Ö –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º.', 'success');
                    }).catch(function(err) {
                        showStatus('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err, 'error');
                    });
                });

                // –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ WebApp
                document.getElementById('expandBtn').addEventListener('click', function() {
                    if (webApp.isExpanded) {
                        webApp.mainButton.hide();
                        this.textContent = '‚ÜïÔ∏è –†–∞—Å—à–∏—Ä–∏—Ç—å WebApp';
                    } else {
                        webApp.expand();
                        this.textContent = '‚ÜïÔ∏è –°–≤–µ—Ä–Ω—É—Ç—å WebApp';
                    }
                });

                // –ó–∞–∫—Ä—ã—Ç–∏–µ WebApp
                document.getElementById('closeAppBtn').addEventListener('click', function() {
                    webApp.close();
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebApp
                webApp.onEvent('viewportChanged', function() {
                    console.log('Viewport changed');
                });

                console.log('‚úÖ WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');

            } catch (error) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                if (document.getElementById('status')) {
                    document.getElementById('status').innerHTML = 
                        '<div class="error">‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message + '</div>';
                }
            }
        })();
    </script>
</body>
</html>
