<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VPN IP</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: sans-serif; text-align:center; margin-top: 40px; }
button { padding: 10px 20px; font-size: 16px; margin-top: 20px; cursor:pointer; }
#status { margin-top: 10px; color: #555; }
</style>
</head>
<body>
<h3>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP...</h3>
<div id="result">‚è≥ –ü–æ–ª—É—á–∞—é IP...</div>
<button id="sendBtn" style="display:none;">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å IP</button>
<div id="status"></div>

<script>
let ip = "";

console.log("‚úÖ WebApp JS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:", window.Telegram?.WebApp);

fetch('https://api.ipify.org?format=json')
  .then(r=>r.json())
  .then(d=>{
    ip = d.ip;
    console.log("‚úÖ –ü–æ–ª—É—á–µ–Ω IP:", ip);
    document.getElementById('result').innerText='–í–∞—à IP: '+ip;
    document.getElementById('sendBtn').style.display = "inline-block";
  })
  .catch(e=>{
    document.getElementById('result').innerText='–û—à–∏–±–∫–∞: '+e;
  });

document.getElementById('sendBtn').onclick = ()=>{
  if (window.Telegram && Telegram.WebApp) {
    try {
      console.log("üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞:", ip);
      Telegram.WebApp.sendData(ip);
      document.getElementById('status').innerText = "‚úÖ IP –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç—É...";
      setTimeout(() => Telegram.WebApp.close(), 500);
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", err);
      document.getElementById('status').innerText = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: "+err;
    }
  } else {
    document.getElementById('status').innerText = "‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.";
  }
};
</script>
</body>
</html>
