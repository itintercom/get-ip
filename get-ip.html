<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VPN IP v5</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: Arial, sans-serif; text-align:center; margin-top: 40px; }
h2 { color: #444; }
#result { font-size: 18px; margin: 20px 0; }
button { padding: 10px 20px; font-size: 16px; margin-top: 20px; cursor:pointer; }
#status { margin-top: 10px; color: #555; white-space: pre-line; }
</style>
</head>
<body>
    <h2>WebApp v5</h2>
    <h3>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞</h3>
    <div id="result">‚è≥ –ü–æ–ª—É—á–∞—é IP...</div>
    <button id="sendBtn" style="display:none;">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å IP</button>
    <div id="status"></div>

<script>
let ip = "";

// –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫
console.log("‚úÖ [v5] WebApp JS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:", window.Telegram?.WebApp);

// –ü–æ–ª—É—á–µ–Ω–∏–µ IP (–Ω–∞–¥—ë–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è iOS)
fetch('https://ipv4.icanhazip.com', {cache:'no-store'})
  .then(r => r.text())
  .then(d => {
      ip = d.trim();
      console.log("‚úÖ [v5] –ü–æ–ª—É—á–µ–Ω IP:", ip);
      document.getElementById('result').innerText = '–í–∞—à IP: ' + ip;
      document.getElementById('sendBtn').style.display = "inline-block";
  })
  .catch(e => {
      console.error("‚ùå [v5] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è IP:", e);
      document.getElementById('result').innerText = '–û—à–∏–±–∫–∞: ' + e;
  });

// –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
document.getElementById('sendBtn').onclick = ()=>{
    const status = document.getElementById('status');
    if (window.Telegram && Telegram.WebApp) {
        try {
            console.log("üì® [v5] –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞:", ip);
            status.innerText = "üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É...";
            Telegram.WebApp.sendData(ip);
            status.innerText += "\n‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã, –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞...";
            setTimeout(() => Telegram.WebApp.close(), 600);
        } catch (err) {
            console.error("‚ùå [v5] –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", err);
            status.innerText = "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: "+err;
        }
    } else {
        console.error("‚ùå [v5] Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        status.innerText = "‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.";
    }
};
</script>
</body>
</html>
