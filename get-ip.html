<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IP Detector</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h2>üì° –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP...</h2>
    <div id="debug"></div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        
        document.getElementById('debug').innerHTML = '<p>WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</p>';

        // –ü–æ–ª—É—á–∞–µ–º IP
        fetch('https://api.ipify.org?format=json')
            .then(r => {
                document.getElementById('debug').innerHTML += '<p>–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç ipify</p>';
                return r.json();
            })
            .then(data => {
                document.getElementById('debug').innerHTML += '<p>–î–∞–Ω–Ω—ã–µ IP –ø–æ–ª—É—á–µ–Ω—ã: ' + data.ip + '</p>';
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π WebApp API
                const ipData = {
                    ip: data.ip,
                    timestamp: new Date().toISOString()
                };
                
                document.getElementById('debug').innerHTML += '<p>–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ sendData...</p>';
                
                try {
                    tg.sendData(JSON.stringify(ipData));
                    document.body.innerHTML = '<h2>‚úÖ IP –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!</h2><p>' + data.ip + '</p><p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç –±–æ—Ç–∞</p>';
                } catch (error) {
                    document.body.innerHTML = '<h2>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message + '</h2>';
                }
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    try {
                        tg.close();
                    } catch (error) {
                        console.log('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:', error);
                    }
                }, 3000);
            })
            .catch(error => {
                document.body.innerHTML = '<h2>‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è IP: ' + error.message + '</h2>';
                document.getElementById('debug').innerHTML += '<p>–û—à–∏–±–∫–∞: ' + error.message + '</p>';
            });
    </script>
</body>
</html>
